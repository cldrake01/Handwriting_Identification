<!DOCTYPE html>
<html lang="en">
<head>
    <title>CSV to Google Drive</title>
    <link rel="stylesheet" href="ctec.css">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <meta name="google-signin-client_id" content="250704395003-bd7nt7jkg0lh9r0rkb2uocrk48lo117t.apps.googleusercontent.com">
</head>
<body>
<div id="input">
    <input type="file" id="csv-file" accept=".csv">
</div>
<!-- Load the Google API client library -->
<script src="https://apis.google.com/js/platform.js" async defer></script>

<!-- Add a button with an ID -->
<script>
    // Initialize the Google Sign-In API with your client ID
    gapi.load('auth2', function() {
        gapi.auth2.init({
            client_id: '250704395003-bd7nt7jkg0lh9r0rkb2uocrk48lo117t'
        });
    });

    // Add a click event listener to the button
    document.getElementById('google-signin-btn').addEventListener('click', function() {
        // Call the Google Sign-In API's signIn() method to initiate the sign-in process
        gapi.auth2.getAuthInstance().signIn();
    });

    // Handle the sign-in response
    function onSignIn(googleUser) {
        // The user has signed in, do something with the user's information
        let profile = googleUser.getBasicProfile();
        console.log('User signed in: ' + profile.getName());
    }
</script>
<script type="module">
    import { Configuration, OpenAIApi } from "openai";
    class property {
        prompt = "Write me a letter to inquire with a landowner about buying or leasing their property for a potential solar farm. If the owner's name is not present, use their company's name instead; if the company's name is also unavailable, address the recipient with 'To the owner of (property address). Your letter should closely mirror the example provided below:\n" +
            "\n" +
            "Holland, Ware\n" +
            "M2797 W Sugarberry Dr\n" +
            "Eagle ID, 83616\n" +
            "December 9, 2022\n" +
            "\n" +
            "Subject: Intent to Lease Land for CTEC Solar Newnan GA,30263 ; Parcel ID: 039 3006 002 & surrounding properties\n" +
            "\n" +
            "Dear Holland,\n" +
            "\n" +
            "I am contacting you today about a proposal to lease several pieces of the property you own in Newnan Ga, 30263 for a community solar project. They are currently listed under Ware Holland M Charitable Foundation. I believe there are a total of 4 parcels you have in the area that we would be interested in speaking with you about.\n" +
            "\n" +
            "We are currently invested in solar projects in your area and we are looking to expand. CTEC Solar not only develops renewable-energy projects, but also constructs, operates, and maintains them. In fact, CTEC is the company the other solar companies often call to build their projects for them.\n" +
            "\n" +
            "Making it work for you:\n" +
            "Landowners receive upfront payments and operating rent. Solar farms can pay rent checks for 20+ years. Leasing your land for a solar farm allows you and your family to generate income from your land, while also holding onto the property and income stream for future generations. Solar farms generate zero emissions and are non hazardous. Solar farms create jobs and tax revenue.\n" +
            "\n" +
            "Currently, there is limited availability in most areas to connect projects due to high levels of interest among property owners and limited capacity for solar projects within the power grid. Because of these factors, I encourage you to reach out to me ASAP to discuss this proposal. We assume the costs of development and permitting at our own risk.\n" +
            "\n" +
            "I would appreciate an opportunity to speak with you so that I may answer any questions and gauge your potential interest. Please respond by calling my cell at (678) 898-6315 when you receive this. You may also text my cell phone or email me at the address below.\n" +
            "\n" +
            "Sincerely,\n" +
            "Warren Kritko\n" +
            "Project Developer\n" +
            "mob: 678-898-6315\n" +
            "Warren.Kritko@ctecsolar.com"
        name;
        company;
        ownerName;
        siteAddress;
        ownerAddress;
        city;
        state;
        zipcode;
        county;
        json;
    }

    let post = new property();

    let fileInput = document.getElementById("csv-file");

    fileInput.addEventListener("change", function () {
        let csvFile = fileInput.files[0];

        let reader = new FileReader();
        reader.readAsText(csvFile);
        reader.onload = async function (event) {
            let csvData = event.target.result;
            let data = [];
            let rows = csvData.split("\n");
            for (let i = 0; i < rows.length; i++) {
                data.push(rows[i].split(","));
            }

            let headers = data[0];
            let owners = new Set();

            for (let i = 1; i < data.length; i++) {
                let row = data[i];

                post.name = row[headers.indexOf("Name")];
                post.company = row[headers.indexOf("Owner")];
                post.ownerName = row[headers.indexOf("Primary Owner First Name")] + " " + row[headers.indexOf("Primary Owner Last Name")];
                post.siteAddress = row[headers.indexOf("Site Address")];
                post.ownerAddress = row[headers.indexOf("Street Address")];
                post.city = row[headers.indexOf("City")];
                post.state = row[headers.indexOf("State")];
                post.zipcode = row[headers.indexOf("Zip")];
                post.county = row[headers.indexOf("County")];
            }

            // Extracted data from CSV file
            // Set up payload for OpenAI API
            console.log(post.toString());
            let payload = {
                prompt: `${post.prompt} Write a letter to ${post.ownerName} at ${post.ownerAddress} about ${post.company}. Here's the entirety of the property's information: ${post.toString()}`,
            };

            const configuration = new Configuration({
                organization: "org-qcHPiKIimtg6ssjx0Xla5AGH",
                apiKey: process.env.OPENAI_API_KEY,
            });

            const {Configuration, OpenAIApi} = require("openai");
            const openai = new OpenAIApi(configuration);
            const response = await openai.createCompletion({
                model: "text-davinci-003",
                prompt: payload,
                max_tokens: 7,
                temperature: 0,
            });

            console.log(response)
            console.log(post.json['choices'][0]['text'])

            /*
            // Make a POST request to the OpenAI API
            post.json = fetch('https://api.openai.com/v1/engines/text-davinci-003', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer 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'
                },
                body: JSON.stringify(payload)
            })
                .then(response => response.json())
                .then(data => {
                    // Handle response from the API
                    console.log(data);
                })
                .catch(error => {
                    // Handle error
                    console.error(error);
                });
            console.log(post.json)
            */
        }
    });
</script>
<div class="g-signin2" id="google" data-onsuccess="onSignIn"></div>
</body>
</html>
