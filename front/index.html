<!DOCTYPE html>
<html lang="en">
<head>
    <title>CSV to Google Drive File Converter</title>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.2.0/papaparse.min.js"></script>
</head>
<body>
<h1>CSV to Google Drive File Converter</h1>
<p>Upload a CSV file to convert it to a Google Drive file:</p>
<input type="file" id="fileInput">
<br><br>
<div id="result" style="display: none;"></div>
<script>
    const { google } = require('googleapis');

    async function uploadToGoogleDrive(file) {
        // Authorize a client with the Google Drive API credentials
        const client = await google.auth.getClient({
            scopes: ['https://www.googleapis.com/auth/drive'],
        });

        // Create a Google Drive API service instance
        const drive = google.drive({ version: 'v3', auth: client });

        // Define the metadata for the file to be uploaded
        const fileMetadata = {
            name: file.name,
        };

        // Define the media for the file to be uploaded
        const media = {
            mimeType: file.type,
            body: file.data,
        };

        // Upload the file to the user's Google Drive
        const response = await drive.files.create({
            // resource: fileMetadata,
            media: media,
            fields: 'id',
        });

        return response.data.id;
    }

    const fileInput = document.getElementById('fileInput');
    const resultDiv = document.getElementById('result');

    fileInput.addEventListener('change', () => {
        const file = fileInput.files[0];
        Papa.parse(file, {
            header: true,
            complete: (results) => {
                uploadToGoogleDrive(results.data);
            }
        });
    });

    socket.onmessage = (event) => {
        const fileUrl = event.data;
        resultDiv.innerHTML = `<p>Your Google Drive file has been created: <a href="${fileUrl}" target="_blank">${fileUrl}</a></p>`;
        resultDiv.style.display = 'block';
    };
</script>
</body>
</html>
